---
title: "Data Management With R: Exploratory Data Analysis"
author: "Matthias Haber"
date: "25 September 2017"
output:
  beamer_presentation:
    theme: "metropolis"
    colortheme: "default"
    fonttheme: "default"
    fig_caption: false
    df_print: default
    toc: true
  ioslides_presentation:
  slidy_presentation: default
  linkcolor: "red"
---
# Prerequisites

## Packages

```{r, message=FALSE}
library(tidyverse)
```

## Data

336,776 flights that departed from New York City in 2013

```{r, message=FALSE}
# install.packages("nycflights13")
library(nycflights13)
```

```{r echo = FALSE}
knitr::kable(flights[1:4, 1:6])
```

# Last week's homework

## Homework Solutions

```{r, message = FALSE, warning=FALSE}
library(tidyverse)
library(nycflights13)
data("flights")
```

## Homework Question 1

```{r}
# Which destination has the most carriers?
flights %>% 
  filter(!is.na(dep_delay), !is.na(arr_delay)) %>% 
  group_by(dest) %>% 
  summarise(carriers = n_distinct(carrier)) %>% 
  arrange(desc(carriers)) %>% 
  head(n = 4)
```

## Homework Question 2

```{r}
# Which destination has the largest spread (standard
# deviation) in terms of distance that planes traveled
# to get to it.
flights %>% 
  group_by(dest) %>% 
  summarise(spread = sd(distance)) %>% 
  arrange(desc(spread)) %>% 
  head(n = 1)
```

## Homework Question 3

```{r}
# What is the average (mean) departure delay of United
# Airlines? Round to the nearest integer.
flights %>% 
  filter(carrier == "UA") %>% 
  summarise(delay = round(mean(dep_delay, na.rm =TRUE)))
```

## Homework Question 4

```{r}
# How many flights were delayed by at least an hour,
# but made up over 45 minutes in flight?
flights %>% 
  filter(dep_delay >= 60, dep_delay-arr_delay > 45) %>% 
  n_distinct()
```

## Homework Question 5

```{r}
# At what time (minutes after midnight) did the first
# flight leave on September 18, 2013?
flights %>% 
  filter(month == 9, day == 18) %>% 
  mutate(dep_time2 = dep_time %/% 100 * 60 + 
           dep_time %% 100) %>% 
  select(dep_time2) %>% 
  arrange(dep_time2) %>% 
  head(n=1)
```

## Homework Question 6

```{r}
# How many flights left before 5am in September (including 
# # of delayed flights from the previous day)?
flights %>% 
  filter(!is.na(dep_delay)) %>% 
  filter(month == 9, dep_time < 500) %>% 
  n_distinct() 
```

## Homework Question 7

```{r}
# Which departure airport (FAA airport code) has the
# highest number of departure delays that are longer
# than 2 hours?
flights %>% 
  filter(dep_delay > 120) %>% 
  group_by(origin) %>% 
  summarise(delay = n())
```

## Homework Question 8

```{r}
# Which departure airport (FAA airport code) has
# the longest mean departure delay in September?
flights %>% 
  filter(month == 9) %>% 
  group_by(origin) %>% 
  summarise(delay = mean(dep_delay, na.rm =TRUE))
```

## Homework Question 9

```{r}
# Which carrier (two letter abbreviation) has the
# shortest average (mean) departure delay when you
# take into account the distance that carrier traveled?
flights %>% 
  group_by(carrier) %>% 
  mutate(delay = dep_delay / distance) %>% 
  summarise(delay = mean(delay, na.rm =T)) %>% 
  arrange(delay) %>% 
  head(n=1)
```

## Homework Question 10

```{r}
# Which plane (tailnum) has the worst on-time
# record in terms of arrival delay?
flights %>% 
  group_by(tailnum) %>% 
  summarise(delay = mean(arr_delay, na.rm =T)) %>% 
  arrange(desc(delay)) %>% 
  head(n=1)
```

# Exploratory Data Analysis

## Goals

> "There are no routine statistical questions, only questionable statistical
> routines." --- Sir David Cox

> "Far better an approximate answer to the right question, which is often
> vague, than an exact answer to the wrong question, which can always be made
> precise." --- John Tukey

Learn how to use visualization and transformation to systematically explore your data to answer or generate questions about your data.

1. What type of variation occurs within my variables?

2. What type of covariation occurs between my variables?


# Variation

## Variation

\alert{Variation}: Difference between expected output to observed output

## Distributions of categorical data
```{r}

diamonds %>% 
  ggplot() +
  geom_bar(mapping = aes(x = cut))
```

## Distributions of continuous data
```{r}
diamonds %>% 
  ggplot() +
  geom_histogram(mapping = aes(x = carat), binwidth = 0.5)
```

## Overlaying multiple distributions 
```{r}
diamonds %>% 
  ggplot(mapping = aes(x = carat, colour = cut)) +
  geom_freqpoly(binwidth = 0.1)
```

# Missing values

# Co-variation

# Exploring Patterns

# Homework Exercises

## Homework Exercises
For this week's homework exersises go to Moodle and answer the Quiz posted in the Data Transformation section. You will be asked a number of questions randomly selected from a question pool. If you work in pairs, then you might get two different sets of questions. 

Deadline: Sunday, October 1 before midnight.

##  {.standout}
That's it for today. Questions?    

